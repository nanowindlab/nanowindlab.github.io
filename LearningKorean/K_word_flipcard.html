<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>K Word Flipcard</title>
  <style>
    :root {
      --primary: #5D5FEF;
      --secondary: #10B981;
      --secondary-2: #34D399;
      --wordText: #FFFFFF;
      --radius: 16px;
      --transition-speed: 0.5s;
      --base-w: 320px;
      --base-h: 450px;
      --card-w: var(--base-w);
      --card-h: var(--base-h);
      --fs-k_word: 50px;
      --fs-e_word: 50px;
      --fs-k_sentence: 32px;
      --pad: 10px;
      /* 36px * 0.66 ≈ 24px */
      --fab-size: 24px;
      --fab-offset: 10px;
    }

    @media (prefers-reduced-motion: reduce) {
      :root { --transition-speed: 0.15s; }
      .slot-inner { transition: none !important; }
    }

    * { box-sizing: border-box; }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: #0f172a;
      font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    #card-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      padding: 20px;
      width: 100%;
      max-width: 1200px;
    }

    .card {
      width: 100%;
      height: 0;
      padding-bottom: 140.625%; /* 450/320 aspect ratio */
      position: relative;
      display: grid;
      grid-template-rows: 2fr 1fr;
      border-radius: var(--radius);
      overflow: hidden;
      background: #FFFFFF;
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    }

    .card-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-rows: 2fr 1fr;
    }

    .slot { position: relative; perspective: 1000px; }
    .slot-inner {
      position: absolute; inset: 0; transform-style: preserve-3d;
      transition: transform var(--transition-speed) cubic-bezier(.2,.8,.2,1);
    }
    .slot.flipped .slot-inner { transform: rotateY(180deg); }
    .face {
      position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
      backface-visibility: hidden; padding: var(--pad);
      border-radius: 0;
    }

    /* DESIGN */
    .front.top { background: #FFFFFF; }
    .back.top  { background: linear-gradient(135deg, #22d3ee, #0ea5e9); color: #fff; transform: rotateY(180deg); flex-direction: column; }
    .front.bottom { background: linear-gradient(135deg, #6366F1, var(--primary)); color: var(--wordText); flex-direction: column; }
    .back.bottom  { background: linear-gradient(135deg, var(--secondary), var(--secondary-2)); color: #fff; transform: rotateY(180deg); flex-direction: column; }

    .image-wrap {
      width: 100%; height: 100%;
      border-radius: 12px; overflow: hidden;
      display: flex; align-items: center; justify-content: center; background: #fff;
      box-shadow: none;
    }
    .image-wrap img { width: 100%; height: 100%; object-fit: contain; }

    .word {
      font-weight: 800; text-align: center; line-height: 1.2;
      font-size: 2.5vw;
      white-space: pre-line;
      word-break: break-word; overflow-wrap: anywhere;
      padding: 0 6px;
    }
    .meaning {
      font-size: 2.5vw; font-weight: 800; text-align: center; white-space: pre-line;
      word-break: break-word; overflow-wrap: anywhere;
      padding: 0 6px;
    }
    .example {
      font-size: 1.8vw;
      text-align: center; white-space: pre-line;
      word-break: break-word; overflow-wrap: anywhere;
      padding: 0 6px;
    }

    .audio-fab {
      position: absolute;
      top: var(--fab-offset);
      right: var(--fab-offset);
      z-index: 2;
      width: var(--fab-size);
      height: var(--fab-size);
      border-radius: 9999px;
      display: inline-flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.22);
      border: 1px solid rgba(255,255,255,0.45);
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
      color: #FFFFFF;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      cursor: pointer;
      transition: transform .18s ease, box-shadow .2s ease, background .25s ease;
    }
    .audio-fab:hover { transform: translateY(-1px) scale(1.08); background: rgba(255,255,255,0.3); box-shadow: 0 10px 26px rgba(0,0,0,.3); }
    .audio-fab:active { transform: translateY(0) scale(0.95); }
    .audio-fab svg { width: 16px; height: 16px; fill: currentColor; }

    .flip-target { outline: none; cursor: pointer; }
    .flip-target:focus-visible { box-shadow: 0 0 0 3px rgba(93,95,239,.35) inset; border-radius: 8px; }

    #pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #fff;
    }
    #pagination button {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin: 0 10px;
      transition: background 0.3s;
    }
    #pagination button:hover {
      background: #4338ca;
    }
    #pagination button:disabled {
      background: #374151;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="card-container"></div>
  <div id="pagination">
    <button id="prev-page">이전</button>
    <span id="page-info"></span>
    <button id="next-page">다음</button>
  </div>

  <script>
    let wordData = [];

    const CARDS_PER_PAGE = 9;
    let currentPage = 1;
    let totalPages = 0;

    // CSV 파싱 함수
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',');
      
      return lines.slice(1).map(line => {
        const values = line.split(',');
        const obj = {};
        headers.forEach((header, index) => {
          const value = values[index] ? values[index].trim() : '';
          obj[header.trim()] = value === 'null' ? null : value;
        });
        return obj;
      });
    }

    // CSV 파일 로드 함수
    async function loadWordData(csvFile = 'word_list_1.csv') {
      try {
        const response = await fetch(csvFile);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const csvText = await response.text();
        wordData = parseCSV(csvText);
        totalPages = Math.ceil(wordData.length / CARDS_PER_PAGE);
        console.log(`Loaded ${wordData.length} words from ${csvFile}`);
        renderPage();
      } catch (error) {
        console.error('CSV 파일 로딩 실패:', error);
        document.getElementById('card-container').innerHTML = 
          '<div style="color: white; text-align: center; padding: 50px;">CSV 파일을 불러오는데 실패했습니다. 서버에서 실행해주세요.</div>';
      }
    }

    const cardContainer = document.getElementById('card-container');
    const pageInfo = document.getElementById('page-info');
    const prevButton = document.getElementById('prev-page');
    const nextButton = document.getElementById('next-page');

    function createCardHTML(card, index) {
      const {
        k_word, e_word, k_sentence, image_url,
        k_audio_url, k_sentence_audio_url, e_audio_url
      } = card;

      // Use k_audio_url for k_word audio
      const k_word_audio_url = card.k_audio_url;

      return `
        <div class="card" role="region" aria-label="단어 플립카드 ${index + 1}">
          <div class="card-content">
            <section class="slot" id="slot-top-${index}">
              <div class="slot-inner">
                <section class="face front top flip-target" role="button" tabindex="0" aria-pressed="false" aria-label="상단 슬롯 뒤집기">
                  <div class="image-wrap">
                    <img src="${image_url || ''}" alt="${k_word || ''} 이미지" />
                  </div>
                </section>
                <section class="face back top">
                  <button class="audio-fab" type="button" aria-label="k_sentence 오디오 재생" data-audio-key="k_sentence" data-audio-src="${k_sentence_audio_url || ''}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                  </button>
                  <p class="example">${(k_sentence || '').replace(/,/g, '\n')}</p>
                </section>
              </div>
            </section>

            <section class="slot" id="slot-bottom-${index}">
              <div class="slot-inner">
                <section class="face front bottom flip-target" role="button" tabindex="0" aria-pressed="false" aria-label="하단 슬롯 뒤집기">
                  <button class="audio-fab" type="button" aria-label="k_word 오디오 재생" data-audio-key="k_word" data-audio-src="${k_word_audio_url || ''}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                  </button>
                  <div class="word">${(k_word || '').replace(/,/g, '\n')}</div>
                </section>
                <section class="face back bottom">
                  <button class="audio-fab" type="button" aria-label="e_word 오디오 재생" data-audio-key="e_word" data-audio-src="${e_audio_url || ''}">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                  </button>
                  <div class="meaning">${(e_word || '').replace(/,/g, '\n')}</div>
                </section>
              </div>
            </section>
          </div>
        </div>
      `;
    }

    function playAudio(src) {
      if (!src) return;
      const a = new Audio(src);
      a.play().catch(() => console.warn('오디오 재생 실패:', src));
    }

    function attachFlip(slotId) {
      const slot = document.getElementById(slotId);
      if (!slot) return;
      const front = slot.querySelector('.front.flip-target');
      const toggle = () => {
        const flipped = slot.classList.toggle('flipped');
        front.setAttribute('aria-pressed', String(flipped));
      };
      slot.addEventListener('click', (e) => {
        if (e.target.closest('[data-audio-key]')) return;
        toggle();
      });
      front.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); }
      });
    }

    function renderPage() {
      if (wordData.length === 0) return;

      cardContainer.innerHTML = ''; // Clear existing cards

      const start = (currentPage - 1) * CARDS_PER_PAGE;
      const end = start + CARDS_PER_PAGE;
      const pageData = wordData.slice(start, end);

      const fragment = document.createDocumentFragment(); // Use a document fragment for efficiency

      pageData.forEach((card, i) => {
        const cardIndex = start + i;
        const cardHTML = createCardHTML(card, cardIndex);
        const tempDiv = document.createElement('div'); // Create a temporary div to parse the HTML string
        tempDiv.innerHTML = cardHTML;
        fragment.appendChild(tempDiv.firstElementChild); // Append the actual card element
      });

      cardContainer.appendChild(fragment); // Append all cards at once

      // Now that all elements are in the DOM, attach event listeners
      pageData.forEach((card, i) => {
        const cardIndex = start + i;
        attachFlip(`slot-top-${cardIndex}`);
        attachFlip(`slot-bottom-${cardIndex}`);
      });

      document.querySelectorAll('[data-audio-key]').forEach(el => {
        const src = el.getAttribute('data-audio-src');
        if (!src) { el.style.display = 'none'; return; }
        el.addEventListener('click', (e) => {
          e.stopPropagation();
          playAudio(src);
        });
        el.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            e.stopPropagation();
            playAudio(src);
          }
        });
      });

      pageInfo.textContent = `페이지 ${currentPage} / ${totalPages}`;
      prevButton.disabled = currentPage === 1;
      nextButton.disabled = currentPage === totalPages;
    }

    prevButton.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderPage();
      }
    });

    nextButton.addEventListener('click', () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderPage();
      }
    });

    // 애플리케이션 초기화
    loadWordData();
  </script>
</body>
</html>